MODULE SQLUtils;

REQUIRE System, Authentication;

getActiveTasksAction 'Обновить список процессов' = ACTION CUSTOM 'lsfusion.erp.utils.GetActiveTasksActionProperty' TOOLBAR;  
cancelActiveTaskAction 'Снять процесс' = ACTION CUSTOM 'lsfusion.erp.utils.CancelActiveTaskActionProperty';  
killActiveTaskAction 'Убить процесс' = ACTION CUSTOM 'lsfusion.erp.utils.KillActiveTaskActionProperty';  

previousCountActiveTask =  DATA SESSION INTEGER();
idActiveTask 'ID процесса' = DATA SESSION INTEGER (INTEGER);
queryActiveTask 'Запрос' = DATA SESSION TEXT (INTEGER);
computerActiveTask 'Компьютер' = DATA SESSION VARSTRING[100] (INTEGER);
userActiveTask 'Пользователь' = DATA SESSION VARSTRING[100] (INTEGER);
addressUserActiveTask 'Адрес пользователя' = DATA SESSION VARSTRING[100] (INTEGER);
dateTimeActiveTask 'Время запуска' = DATA SESSION DATETIME (INTEGER);

FORM activeTasks 'Активные процессы' 
    OBJECTS i = INTEGER
    PROPERTIES(i) READONLY idActiveTask, queryActiveTask, computerActiveTask, userActiveTask, addressUserActiveTask, dateTimeActiveTask
    PROPERTIES(i) TOOLBAR cancelActiveTaskAction, killActiveTaskAction
    PROPERTIES() getActiveTasksAction TOOLBAR TODRAW i
    FILTERS idActiveTask(i)
;

getActiveBlocksAction 'Обновить список блокировок' = ACTION CUSTOM 'lsfusion.erp.utils.GetActiveBlocksActionProperty' TOOLBAR;  

previousCountActiveBlock =  DATA SESSION INTEGER();
processIdActiveBlock 'ID процесса блокировки' = DATA SESSION INTEGER (INTEGER);
typeLockedObjectActiveBlock 'Тип заблокированного объекта' = DATA SESSION VARSTRING[100] (INTEGER);
idLockedObjectActiveBlock 'ID заблокированного объекта' = DATA SESSION VARSTRING[100] (INTEGER);
modeActiveBlock 'Уровень блокировки' = DATA SESSION VARSTRING[100] (INTEGER);
grantedActiveBlock 'Granted' = DATA SESSION BOOLEAN (INTEGER);

FORM activeBlocks 'Активные блокировки' 
    OBJECTS i = INTEGER
    PROPERTIES(i) READONLY processIdActiveBlock, typeLockedObjectActiveBlock, idLockedObjectActiveBlock, modeActiveBlock, grantedActiveBlock
    PROPERTIES() getActiveBlocksAction TOOLBAR TODRAW i
    FILTERS processIdActiveBlock(i)
;

NAVIGATOR {
    systemEvents {
        ADD activeTasks;
        ADD activeBlocks;
    }
}
