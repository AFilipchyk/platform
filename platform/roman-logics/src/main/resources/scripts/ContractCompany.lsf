MODULE ContractCompany;

REQUIRE Contract, Company;

NAMESPACE Contract;

CLASS contractSkuCompany 'Договор на поставку между компаниями' : contractSku;

companyAContractSkuCompany = DATA company (contractSkuCompany) AUTOSET;
nameCompanyAContractSkuCompany 'Компания (поставщик)' (contract) = name(companyAContractSkuCompany(contract)) IN recognizeGroup MAXCHARWIDTH 30 PREFCHARWIDTH 30;
partyAContract (contract) += companyAContractSkuCompany(contract);

companyBContractSkuCompany = DATA company (contractSkuCompany) AUTOSET;
nameCompanyBContractSkuCompany 'Компания (покупатель)' (contract) = name(companyBContractSkuCompany(contract)) IN recognizeGroup MAXCHARWIDTH 30 PREFCHARWIDTH 30;
partyBContract (contract) += companyBContractSkuCompany(contract);

@defineContractDefaultCustom(contractSkuCompany, company, company, companyA, companyB);

// Формы
FORM contractSkuCompany 'Договор'
    OBJECTS c=contractSkuCompany FIXED PANEL
    PROPERTIES(c) nameCompanyAContractSkuCompany, nameCompanyBContractSkuCompany,
                  numberContract, dateFromContract, dateToContract,
                  nameCurrencyContract, noteContract

    OBJECTS pc = paymentCondition
    PROPERTIES(pc) READONLY datePaymentCondition, numberContractPaymentCondition, nameTypePaymentCondition,
                            nameFormPaymentCondition
    PROPERTIES(pc) ADDSESSIONFORM, EDITSESSIONFORM, delete
    ORDER BY datePaymentCondition

    FILTERS contractPaymentCondition(pc) == c

    EDIT contractSkuCompany OBJECT c
;

FORM contractsSkuCompany 'Договора'
    OBJECTS c=contractSkuCompany
    PROPERTIES(c) READONLY numberContract, dateFromContract, dateToContract,
                           nameCompanyAContractSkuCompany, nameCompanyBContractSkuCompany, nameTypeContractSku

    PROPERTIES(c) ADDFORM, EDITFORM, delete
    ORDER BY dateFromContract

    DIALOG contractSkuCompany OBJECT c
;

EXTEND FORM company

    OBJECTS cb=company
    PROPERTIES(cb) name
    PROPERTIES(co, cb)    numberContractSkuCompanyCompanyCompany

    OBJECTS cc=contractSkuCompany
    PROPERTIES(cc)  READONLY numberContract, dateFromContract, dateToContract,
                            nameTypeContractSku, nameFormContractSku,
                            nameCurrencyContract, noteContract
    PROPERTIES(co, cb, cc) isCompanyCompanyContractSkuCompany
    PROPERTIES(cc)  ADDFORM, EDITFORM, delete
    FILTERS companyAContractSkuCompany(cc) == co,
            companyBContractSkuCompany(cc) == cb
;

EXTEND DESIGN company {
    extendContainer {
        NEW companyContractSku {
            title = 'Договора между компаниями';
            type = SPLITH;
            childConstraints = TO THE RIGHT;

            ADD cb.box;
            ADD cc.box {
                fillHorizontal = 2;
            }
        }
    }
}