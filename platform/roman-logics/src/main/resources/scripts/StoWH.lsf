//To Store From Store (the different company)
MODULE StoWH;

REQUIRE System,

        Stock,
        Numerator,
        Document,
        RomanDocument,
        Consignment,
        Declaration,
        MasterData,
        RomanLogicsModule;

PRIORITY RomanLogicsModule, Stock;

CLASS StoWH 'Расход с магазина на склад' : historyObject, numberedObject, consignment;
CLASS StoWHDetail 'Строка расхода с магазина на склад' : outAutoSkuLedger, consignmentDetail;
CLASS StoWHPosted 'Закрытый расход с магазина на склад' : StoWH, postedObject, consignment;


skuStoWHDetail 'Товар (ИД)' (StoWHDetail) = DATA sku (StoWHDetail)IN idGroup;
nameSkuStoWHDetail 'Наименование товара' (StoWHDetail) = nameSku(skuStoWHDetail(StoWHDetail));

@defineRBCorrespondingDocumentWithRetailPrices(StoWH, departmentStore, 'Отдел документа', sku, 'Расход с магазина на склад', warehouse, 'Склад-получатель');
@defineDocumentDetailPackWeightSku(StoWH);
@defineDocumentHeaderSkuQuantity(StoWH);

senderStoreStoWH 'Магазин-отправитель (ИД)' (StoWH) = storeDepartmentStore(departmentStoreStoWH(StoWH));
nameSenderStoreStoWHDetail 'Магазин-отправитель' (StoWHDetail) = name(senderStoreStoWH(StoWHDetail)) MINCHARWIDTH 20 PREFCHARWIDTH 20;

FORM StoWH 'Расход с магазина на склад'
    OBJECTS s = StoWH FIXED PANEL
    PROPERTIES (s) numberObject, seriesObject, dateStoWH, timeStoWH, nameDepartmentStoreStoWH, nameCorrWarehouseStoWH,
                   quantityStoWHDetailStoWH, invoiceVATSumStoWHDetailStoWH, invoiceSumStoWHDetailStoWH, retailSumStoWHDetailStoWH, noteStoWH

    OBJECTS d = StoWHDetail

    PROPERTIES(d) indexStoWHDetail, barcodeStoWHDetail, nameSkuStoWHDetail, shortNameUOMStoWHDetail, sidSizeStoWHDetail,
                  nameBrandStoWHDetail, sidArticleStoWHDetail, nameCategoryStoWHDetail, sidColorStoWHDetail,
                  nameColorStoWHDetail, balanceBSkuStoWHDetail, quantityStoWHDetail, importerPriceStoWHDetail,
                  supplierPriceStoWHDetail, supplierSumStoWHDetail, numberSupplierVATStoWHDetail, valueSupplierVATStoWHDetail,
                  supplierVATSumStoWHDetail, invoiceSumStoWHDetail, numberRetailVATStoWHDetail, valueRetailVATStoWHDetail,
                  retailPriceStoWHDetail, retailSumStoWHDetail, calcRetailMarkupStoWHDetail


    PROPERTIES(s) TODRAW d addDetailDialogSkuStoWHDetailStoWH, addDetailDialogBarcodeStoWHDetailStoWH, deleteStoWHDetailStoWH


    PROPERTIES(d) ADDOBJ, delete

    FILTERS inStoWHStoWHDetail(s, d)

    EDIT StoWH OBJECT s
;

DESIGN StoWH FROM DEFAULT {
    main {
        preferredSize = (1024, 768);
        ADD s.box {
            childConstraints = TO THE RIGHT;
            NEW row1 {
                childConstraints = TO THE BOTTOM;
                ADD s.documentHeaderGroup {
                    childConstraints = TO THE RIGHT;
                    ADD PROPERTY (nameDepartmentStoreStoWH);
                    ADD PROPERTY (numberObject);
                    ADD PROPERTY (seriesObject);
                    ADD PROPERTY (dateStoWH);
                    ADD PROPERTY (timeStoWH);
                }
                NEW case {
                childConstraints = TO THE BOTTOM;
                    title = 'Контрагент';
                    ADD PROPERTY (nameCorrWarehouseStoWH);
                }
                ADD s.documentPrmGroup;
            }
            NEW row2 {
                ADD s.documentSumGroup {
                    childConstraints = TO THE BOTTOM;
                }
            }
        };
        ADD d.box;
        ADD functions.box;
    }
}

FORM StoWHs 'Расходы с магазина на склад'
    OBJECTS s = StoWH

    PROPERTIES (s) READONLY objectClassName, numberObject, seriesObject, dateStoWH, timeStoWH, nameDepartmentStoreStoWH,
                            nameCorrWarehouseStoWH, countStoWHDetailStoWH, quantityStoWHDetailStoWH,
                            supplierSumStoWHDetailStoWH, invoiceVATSumStoWHDetailStoWH, invoiceSumStoWHDetailStoWH,
                            retailSumStoWHDetailStoWH, noteStoWH

    PROPERTIES (s) READONLY FORCE PANEL nameUserCreated, timeCreated, hostnameComputerCreated, nameUserClosed, timeClosed, hostnameComputerClosed


    PROPERTIES (s) ADDFORM, EDITFORM SHOWIF isDraftStoWH(s), delete FORCE PANEL SHOWIF isDraftStoWH(s),
                   postStoWH SHOWIF isDraftStoWH(s), unpostStoWH SHOWIF isPostedStoWH(s)

    OBJECTS d = StoWHDetail

    PROPERTIES(d) READONLY  indexStoWHDetail, barcodeStoWHDetail, nameSkuStoWHDetail, shortNameUOMStoWHDetail, sidSizeStoWHDetail,
                            nameBrandStoWHDetail, sidArticleStoWHDetail, nameCategoryStoWHDetail, sidColorStoWHDetail,
                            nameColorStoWHDetail, balanceBSkuStoWHDetail, quantityStoWHDetail, importerPriceStoWHDetail,
                            supplierPriceStoWHDetail, supplierSumStoWHDetail, numberSupplierVATStoWHDetail, valueSupplierVATStoWHDetail,
                            supplierVATSumStoWHDetail, invoiceSumStoWHDetail, numberRetailVATStoWHDetail, valueRetailVATStoWHDetail,
                            retailPriceStoWHDetail, retailSumStoWHDetail, calcRetailMarkupStoWHDetail

    FILTERS inStoWHStoWHDetail(s, d)
;

DESIGN StoWHs FROM DEFAULT {
    ADD s.box{
        PROPERTY (delete(s)) {
            panelLocation = TOOLBAR;
            askConfirm = TRUE;
        PROPERTY (objectClassName(s)) {
            preferredCharWidth = 15;
        }
        }
    }
    ADD d.box;

    NEW footer.container {
        childConstraints = TO THE BOTTOM;

        NEW cont3 {
            childConstraints = TO THE RIGHT;
            ADD s.historyGroup {
                childConstraints = TO THE BOTTOM;
            }

            ADD s.postedGroup {
                childConstraints = TO THE BOTTOM;
            }
        }
    }
    ADD functions.box;
}

FORM StoWHsDialog 'Расходы с магазина на склад'
    OBJECTS s = StoWHPosted
    PROPERTIES (s) READONLY objectClassName, numberObject, seriesObject, dateStoWH, timeStoWH, nameDepartmentStoreStoWH,
                            nameCorrWarehouseStoWH, countStoWHDetailStoWH, quantityStoWHDetailStoWH,
                            supplierSumStoWHDetailStoWH, invoiceVATSumStoWHDetailStoWH, invoiceSumStoWHDetailStoWH,
                            retailSumStoWHDetailStoWH, noteStoWH

    DIALOG StoWHPosted OBJECT s
;

//@defineConsignment(StoWH);
//@implementConsignmentHeader(StoWH, departmentStore);

//senderConsignment (consignment) += companyStore(senderStoreStoWH(consignment));
//recipientConsignment (consignment) += companyStore(corrWarehouseStoWH(consignment));
//consignmentConsignmentDetail (consignmentDetail) += StoWHStoWHDetail (consignmentDetail);
//skuConsignmentDetail (consignmentDetail) += skuStoWHDetail (consignmentDetail);
//shortNameUOMConsignmentDetail (consignmentDetail) += shortNameUOMStoWHDetail (consignmentDetail);
//quantityConsignmentDetail (consignmentDetail) += quantityStoWHDetail (consignmentDetail);
//priceConsignmentDetail (consignmentDetail) += retailPriceStoWHDetail (consignmentDetail);
//vatConsignmentDetail (consignmentDetail) += valueRetailVATStoWHDetail (consignmentDetail);
//sumVATConsignmentDetail (consignmentDetail) += supplierVATISumStoWHDetail (consignmentDetail);
//sumConsignmentDetail (consignmentDetail) += supplierSumStoWHDetail (consignmentDetail);
//sumInvoiceConsignmentDetail (consignmentDetail) += invoiceSumStoWHDetail (consignmentDetail);
//grossWeightConsignmentDetail (consignmentDetail) += grossWeightStoWHDetail (consignmentDetail);
//packQuantityConsignmentDetail (consignmentDetail) += packQuantityStoWHDetail(consignmentDetail);
//currencyConsignment(consignment) += currencyStoWH(consignment);
//isCustomsFlowConsignment (consignment) += consignment IS StoWH;
//noteConsignment(consignment) += noteStoWH(consignment);

//noteConsignmentDetail

//todo: Надо наполнить свойствами накладную. (УНП...)