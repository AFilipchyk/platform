MODULE Cash;

REQUIRE PaymentLedger;

// ----------------------------------- Кассовый счет ------------------------------------------ //

CLASS Account 'Касса';
TABLE account (Account);

currencyAccount = DATA Currency (Account);
nameCurrencyAccount 'Валюта счета' = name(currencyAccount(account));

numberAccount 'Номер кассового счета'  = DATA STRING[13] (Account) FIXEDCHARWIDTH 13;

legalEntityAccount = DATA LegalEntity (Account);
nameLegalEntityAccount 'Организация' = name(legalEntityAccount(account));
defaultAccountLegalEntity(legalEntity) = GROUP MAX account BY legalEntityAccount(account);

EXTEND CLASS Account : PaymentLedger.Account;
PaymentLedger.nameAccount(account) += numberAccount(account);
PaymentLedger.currencyAccount(account) += currencyAccount(account);
PaymentLedger.legalEntityAccount(account) += legalEntityAccount(account);

FORM account 'Счет'
    OBJECTS a = Cash.Account FIXED PANEL
    PROPERTIES(a) numberAccount, nameCurrencyAccount, nameLegalEntityAccount

    EDIT Cash.Account OBJECT a
;

FORM accounts 'Счета'
    OBJECTS a = Cash.Account
    PROPERTIES(a) READONLY numberAccount, nameCurrencyAccount
    PROPERTIES(a) ADDFORM, EDITFORM, delete

    DIALOG Cash.Account OBJECT a
;

EXTEND FORM legalEntity
    OBJECTS ca=Account
    PROPERTIES(ca)  numberAccount, nameCurrencyAccount, ADDOBJ, delete
    FILTERS legalEntityAccount(ca) == l
;

EXTEND DESIGN legalEntity {
    accountContainer {
        ADD ca.box{
            caption = 'Кассы';
        }
    }
}