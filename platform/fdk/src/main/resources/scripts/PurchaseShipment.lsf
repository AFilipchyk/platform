MODULE PurchaseShipment;

REQUIRE Shipment, PurchaseInvoice;

NAMESPACE Purchase;


//----------------------------------------------- Поставка ---------------------------------------------------//

@defineShipment(' (покупка)', supplier, 'Поставщик', supplier, company);

// Цены учетные
priceUserShipmentDetail (detail) <- priceInvoiceDetail(invoiceDetailUserShipmentDetail(detail))
    WHEN CHANGED(priceInvoiceDetail(invoiceDetailUserShipmentDetail(detail)));
shipmentPriceUserInvoiceDetail(detail) <- calcShipmentPriceUserInvoiceDetail(detail) (+) extraShipmentPriceUserInvoiceDetail(detail) WHEN
    (CHANGED(calcShipmentPriceUserInvoiceDetail(detail)) OR CHANGED(extraShipmentPriceUserInvoiceDetail(detail)) OR CHANGED(createShipmentUserInvoiceDetail(detail)))
        AND createShipmentUserInvoiceDetail(detail);

// Проводим по регистру

@implementBatch(shipment, sku, stock, price);
quantityBatch (ledger) += quantityShipmentDetail(ledger);
supplierBatch (ledger) += supplierShipmentDetail(ledger);
sumInSkuLedger (ledger) += sumShipmentDetail(ledger);

@implementAccountDocumentLedgerInc(shipment, stock);
sumIncAccountDocumentLedger (ledger) += sumShipmentDetailShipment(ledger);
sumItemIncAccountDocumentLedger (ledger) += sumItemShipmentDetailShipment(ledger);
sumContainerIncAccountDocumentLedger (ledger) += sumContainerShipmentDetailShipment(ledger);