MODULE PurchaseInvoiceGeneralLedger;

REQUIRE GeneralLedger, PurchaseInvoice, DimensionLegalEntity, DimensionStock;
PRIORITY Purchase;

//------------------- Приход товара/тары от поставщ. --------------------//

EXTEND CLASS Invoice : GeneralLedger.GLDocument;
nameGLDocument(document) += descriptionInvoice(document);

//-------------------------------- НДС поставщика ----------------------------------//
//-- Тара
@defineDocumentHeaderItemSum (invoice, VAT, VAT);
@defineGeneralLedgerAggregation (invoice, InvSupVATC, customer, VATSumContainerInvoiceDetailInvoice, date, descriptionInvoice, '18.5', '60.1', '1');
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += customerStockInvoice(invoiceInvSupVATCGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupVATCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock;
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += supplierInvoice(invoiceInvSupVATCGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupVATCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization;
//-- Услуги
@defineGeneralLedgerAggregation (invoice, InvSupVATCH, customer, VATSumChargeInvoiceDetailInvoice, date, descriptionInvoice, '18.6', '60.1', '1');
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += customerStockInvoice(invoiceInvSupVATCHGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupVATCHGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock;
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += supplierInvoice(invoiceInvSupVATCHGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupVATCHGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization;
//-- Товар
@defineGeneralLedgerAggregation (invoice, InvSupVATI, customer, VATSumItemInvoiceDetailInvoice, date, descriptionInvoice, '18.1', '60.1', '1');
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += customerStockInvoice(invoiceInvSupVATIGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupVATIGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock;
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += supplierInvoice(invoiceInvSupVATIGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupVATIGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization;

//-------------------------------- Сумма поставщика ----------------------------------//
//-- Тара
@defineDocumentHeaderItemSum (invoice, , );
@defineGeneralLedgerAggregation (invoice, InvSupC, customer, sumContainerInvoiceDetailInvoice, date, descriptionInvoice, '41.3', '60.1', '1');
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += customerStockInvoice(invoiceInvSupCGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock;
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += supplierInvoice(invoiceInvSupCGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization;
//-- Товар
@defineGeneralLedgerAggregation (invoice, InvSupIH, customer, sumItemInvoiceDetailInvoice, date, descriptionInvoice, '41.2', '60.1', '1');
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += customerStockInvoice(invoiceInvSupIHGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupIHGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock;
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += supplierInvoice(invoiceInvSupIHGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupIHGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization;
////-- Тара                                               в примере две проводки, надо выбрать какая из них
//@defineDocumentHeaderItemSum (invoice, , );
//@defineGeneralLedgerAggregation (invoice, InvSupC, customer, sumContainerInvoiceDetailInvoice, date, descriptionInvoice, '44.3', '60.1', '1');
//debitGeneralLedgerDimensionType(generalLedger,dimensionType) += customerStockInvoice(invoiceInvSupCGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock;
//creditGeneralLedgerDimensionType(generalLedger,dimensionType) += supplierInvoice(invoiceInvSupCGeneralLedger(generalLedger)) WHEN CLASS(invoiceInvSupCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization;

