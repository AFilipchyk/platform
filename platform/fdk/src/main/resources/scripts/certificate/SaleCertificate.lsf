MODULE SaleCertificate;

REQUIRE Certificate, SaleInvoice, SaleShipment;

NAMESPACE Sale;

@extendCertificateForm(invoice, i);
@extendCertificateForm(shipment, s);

META derivePropUserInvoiceDetail(prop)
    prop###userInvoiceDetail(userInvoiceDetail)  <- IF prop###batch(batchUserInvoiceDetail(userInvoiceDetail))
                                                            THEN prop###batch(batchUserInvoiceDetail(userInvoiceDetail))
                                                            ELSE prop###batch(lastOrderBatchSkuStock(skuUserInvoiceDetail(userInvoiceDetail), supplierStockUserInvoiceDetail(userInvoiceDetail)))
        WHEN CHANGED (batchUserInvoiceDetail(userInvoiceDetail)) OR
             CHANGED (skuUserInvoiceDetail(userInvoiceDetail)) OR
             CHANGED (supplierStockUserInvoiceDetail(userInvoiceDetail));
END